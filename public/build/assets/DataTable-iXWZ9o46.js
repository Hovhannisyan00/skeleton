function u(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const h="datatable_search_values",c="datatable_search_state";class f{constructor(e={},a="#__data__table"){this.initVariables(e,a),this.setSearchStoredData(),this.columnDefaultRender(e),this.init()}initVariables(e,a){var s;this.tableId=a,this.tableEl=$(a),this.options=e,this.searchFormId=(s=e.searchFormId)!=null?s:"dataTable__search__form",this.searchFormEl=$("#".concat(this.searchFormId)),this.searchData={},this.pathOptions=e.pathOptions}columnDefaultRender(e){const a={show_status:{render(s){return'<span class="show-status-'.concat(s,'">').concat($trans("__dashboard.select.option.show_status_".concat(s)),"</span>")}}};e.columnsRender={...a,...e.columnsRender}}storeSearchData(){var e;return(e=this.options.storeSearchData)!=null?e:!0}actions(){const e=(t,r)=>this.pathOptions["".concat(r,"Path")].replace(":id",t),a=this,s={edit(t){return'<a href="'.concat(e(t.id,"edit"),'" class="btn" title="Edit">\n                    <i class="flaticon-edit"></i>\n                </a>')},show(t){return'<a href="'.concat(e(t.id,"show"),'" class="btn" title="Show">\n                   <i class="flaticon-eye"></i>\n                </a>')},clone(t){return a.pathOptions.clonePath?'<a href="'.concat(e(t.id,"clone"),'" class="btn" title="Duplicate">\n                   <i class="fas fa-copy fa-fw"></i>\n                </a>'):""},delete(t){return typeof t.canDelete<"u"&&!t.canDelete?"":'<button type="button" data-url="'.concat(e(t.id,"delete"),'" data-event-name="deleteDataTableRow" class="btn __confirm__delete__btn" title="Delete">\n                    <i class="flaticon2-trash"></i>\n                </button>')}};this.options.actions={...s,...this.options.actions}}renderActions(e,a,s,t){let r="";for(const[o,i]of Object.entries(this.options.actions))typeof i!="boolean"&&(r+=i(s));return'<div class="text-center table-buttons">'.concat(r,"</div>")}columnRenderRelation(e){const a=e.data;if(this.options.relations&&this.options.relations[a]){const s=this.options.relations[a];e.render=t=>{let r="";if(t&&!Array.isArray(t)){if(typeof s!="string"){const o=Object.keys(s)[0]||"";if(t[o])return t[o][s[o]]}return t[s]||""}return Array.isArray(t)?(t.map((o,i)=>{if(typeof s!="string"){const n=Object.keys(s)[0]||"";if(o[n]){const l=o[n][s[n]];r+=i?", ".concat(l):l}}else r+=i?", ".concat(o[s]):o[s]}),r):""}}return e}actionsColumn(){return{data:null,orderable:!1,sortable:!1,render:this.renderActions.bind(this)}}mapTableColumns(e=[]){return this.tableEl.find("thead th").map((s,t)=>{var n;const r=$(t).data("key");let o={data:r,name:r,orderable:(n=$(t).data("orderable"))!=null?n:!0};const{columnsRender:i}=this.options;i&&i[r]&&(o={...o,...i[o.data]}),r&&e.push(this.columnRenderRelation(o))}),e}getAndGenerateColumns(){const e=this.mapTableColumns();return(typeof this.options.noActions>"u"||!this.options.noActions)&&e.push(this.actionsColumn()),e}generateRequestData(e){let a=e.order[0];return{"order[sort_by]":e.columns[a.column].name,"order[sort_desc]":a.dir,perPage:e.length,start:e.start,...this.searchData}}async ajaxSend(e,a){this.resetForm();const s=this.getDefaultSearchInputField();s.val()&&s.val().trim()&&s.prop("readOnly",!0),await axios(this.pathOptions.searchPath,{params:this.generateRequestData(e)}).then(t=>{a(t.data),this.options.beforeSendRequest&&this.options.beforeSendRequest(t.data)}).catch(t=>{console.log("err",t),this.errorHandler(t),a({data:[],recordsFiltered:0})}).finally(()=>{s.prop("readOnly",!1)}),this.searchFromLoading()}errorHandler(e){if(e=e.response.data,e){const a=this.searchFormEl;a.find(".validation-error").removeClass("has-error"),a.find(".form-group").removeClass("is-invalid");for(const[s,t]of Object.entries(e.errors)){const r=s.substring(2);let o=a.find('.validation-error[data-name="'.concat(r,'"]'));o.length||(o=a.find('.validation-error[data-name="'.concat(r,'[]"]'))),o.closest(".form-group").addClass("is-invalid"),o.html(t).addClass("has-error")}}}resetForm(){this.searchFormEl.find(".validation-error").html(""),this.searchFormEl.find(".form-group").removeClass("is-invalid")}generateOptions(){const e=this.getCurrentModuleName(),a={processing:!0,serverSide:!0,searching:!0,ajax:this.ajaxSend.bind(this),order:[[0,"desc"]],pageLength:25,columns:this.getAndGenerateColumns(),bStateSave:!0,stateSaveCallback(t,r){const o={};r.search&&(r.search.search=""),o[e]=r,localStorage.setItem(c,JSON.stringify(o))},language:{search:"",searchPlaceholder:$trans("__dashboard.datatable.search_input_placeholder")}},s=JSON.parse(localStorage.getItem(c));s&&s[e]&&(a.stateLoadCallback=()=>s[e]),this.options={...a,...this.options}}tableReload(){this.table.ajax.reload()}eventListener(){window.addEventListener("deleteDataTableRow",()=>{this.tableReload()})}searchFromLoading(e){const a=this.searchFormEl.find("button.search__form__btn"),s=this.searchFormEl.find("button.reset__form__btn"),t=this.searchFormEl.find(".loading__form__icon");e?(t.addClass("d-inline-block "),a.prop("disabled",!0),s.prop("disabled",!0)):(t.removeClass("d-inline-block"),a.prop("disabled",!1),s.prop("disabled",!1))}searchFormReset(){this.searchFormEl.find(".reset__form__btn").click(()=>{this.searchFromLoading(!0),this.searchData={},this.searchFormEl[0].reset(),this.table.search(""),this.clearSearchedDataFromLocalstorage(),this.searchFormEl.find(".select2").val(null).trigger("change"),this.tableReload(),this.getSearchCollapse().removeClass("has-default-values")})}searchFormSubmit(e){e.preventDefault();const a=e.target;this.searchData={},this.searchFromLoading(!0),$(a).serializeArray().map((t,r)=>{let o="";$(a).find('select[name="'.concat(t.name,'"][multiple]')).length&&(o="[".concat(r,"]")),this.searchData["f[".concat(t.name,"]").concat(o)]=t.value}),this.table.search().length&&(this.searchData["f[search]"]=this.table.search()),this.storeSearchedData(),this.tableReload()}storeSearchedData(){if(this.storeSearchData()){const a=this.searchFormEl.serializeArray().filter(r=>r.value!==""||r.name==="show_status"),s=this.getCurrentModuleName(),t={};t[s]=a,localStorage.setItem(h,JSON.stringify(t)),this.options.afterStoreSearchedData&&this.options.afterStoreSearchedData(t)}}setSearchStoredData(){if(this.storeSearchData()){const e=JSON.parse(localStorage.getItem(h)),a=this.getCurrentModuleName();if(e&&e[a]&&e[a].length){const s=this,t=e[a];let r=!0;t.length===1&&$.inArray(t[0].name,["search","show_status"])!==-1&&(r=!1),t.length===2&&t[0].name==="show_status"&&t[1].name==="search"&&(r=!1),r&&this.showSearchCollapse();const o=t.reduce((i,n)=>(typeof i[n.name]>"u"?i[n.name]=n.value:Array.isArray(i[n.name])?i[n.name].push(n.value):i[n.name]=[i[n.name],n.value],i),{});$.each(o,(i,n)=>{const l=s.searchFormEl.find(":input[name='".concat(i,"']"));!Array.isArray(n)&&l.attr("multiple")}),this.options.afterSetSearchStoredData&&this.options.afterSetSearchStoredData(t)}}}getSearchCollapse(){return this.searchFormEl.closest(".datatable-search-collapse").find(".collapse")}showSearchCollapse(){this.getSearchCollapse().addClass("has-default-values show")}getCurrentModuleName(){return location.pathname.split("/")[3]}clearSearchedDataFromLocalstorage(){localStorage.removeItem(h),localStorage.removeItem(c)}defaultSearchData(){const e=this;$.each(this.searchFormEl.find(".default-search"),(a,s)=>{e.searchData["f[".concat($(s).attr("name"),"]")]=$(s).val()})}createDataTable(){this.table=this.tableEl.DataTable(this.options)}defaultSearchInput(){const e=this;let a;this.getDefaultSearchInputField().unbind().bind("keyup input",function(){clearTimeout(a),a=setTimeout(()=>{e.searchData["f[search]"]=$(this).val(),e.table.search($(this).val()),e.tableReload(),e.storeSearchedData()},330)})}getDefaultSearchInputField(){return $("#".concat(this.tableId.substring(1),"_filter")).find("input")}$_functions(){this.createDataTable(),this.searchFormEl.submit(this.searchFormSubmit.bind(this))}init(){this.actions(),this.defaultSearchData(),this.generateOptions(),this.eventListener(),this.$_functions(),this.searchFormReset(),this.defaultSearchInput()}}export{f as D,u as __vite_legacy_guard};
//# sourceMappingURL=DataTable-iXWZ9o46.js.map
