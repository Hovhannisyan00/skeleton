System.register([],(function(e,t){"use strict";return{execute:function(){const t="datatable_search_values",a="datatable_search_state";e("D",class{constructor(e={},t="#__data__table"){this.initVariables(e,t),this.setSearchStoredData(),this.columnDefaultRender(e),this.init()}initVariables(e,t){this.tableId=t,this.tableEl=$(t),this.options=e,this.searchFormId=e.searchFormId??"dataTable__search__form",this.searchFormEl=$(`#${this.searchFormId}`),this.searchData={},this.pathOptions=e.pathOptions}columnDefaultRender(e){const t={show_status:{render:e=>`<span class="show-status-${e}">${$trans(`__dashboard.select.option.show_status_${e}`)}</span>`}};e.columnsRender={...t,...e.columnsRender}}storeSearchData(){return this.options.storeSearchData??!0}actions(){const e=(e,t)=>this.pathOptions[`${t}Path`].replace(":id",e),t=this,a={edit:t=>`<a href="${e(t.id,"edit")}" class="btn" title="Edit">\n                    <i class="flaticon-edit"></i>\n                </a>`,show:t=>`<a href="${e(t.id,"show")}" class="btn" title="Show">\n                   <i class="flaticon-eye"></i>\n                </a>`,clone:a=>t.pathOptions.clonePath?`<a href="${e(a.id,"clone")}" class="btn" title="Duplicate">\n                   <i class="fas fa-copy fa-fw"></i>\n                </a>`:"",delete:t=>void 0===t.canDelete||t.canDelete?`<button type="button" data-url="${e(t.id,"delete")}" data-event-name="deleteDataTableRow" class="btn __confirm__delete__btn" title="Delete">\n                    <i class="flaticon2-trash"></i>\n                </button>`:""};this.options.actions={...a,...this.options.actions}}renderActions(e,t,a,s){let r="";for(const[i,o]of Object.entries(this.options.actions))"boolean"!=typeof o&&(r+=o(a));return`<div class="text-center table-buttons">${r}</div>`}columnRenderRelation(e){const t=e.data;if(this.options.relations&&this.options.relations[t]){const a=this.options.relations[t];e.render=e=>{let t="";if(e&&!Array.isArray(e)){if("string"!=typeof a){const t=Object.keys(a)[0]||"";if(e[t])return e[t][a[t]]}return e[a]||""}return Array.isArray(e)?(e.map(((e,s)=>{if("string"!=typeof a){const r=Object.keys(a)[0]||"";if(e[r]){const i=e[r][a[r]];t+=s?`, ${i}`:i}}else t+=s?`, ${e[a]}`:e[a]})),t):""}}return e}actionsColumn(){return{data:null,orderable:!1,sortable:!1,render:this.renderActions.bind(this)}}mapTableColumns(e=[]){return this.tableEl.find("thead th").map(((t,a)=>{const s=$(a).data("key");let r={data:s,name:s,orderable:$(a).data("orderable")??!0};const{columnsRender:i}=this.options;i&&i[s]&&(r={...r,...i[r.data]}),s&&e.push(this.columnRenderRelation(r))})),e}getAndGenerateColumns(){const e=this.mapTableColumns();return void 0!==this.options.noActions&&this.options.noActions||e.push(this.actionsColumn()),e}generateRequestData(e){let t=e.order[0];return{"order[sort_by]":e.columns[t.column].name,"order[sort_desc]":t.dir,perPage:e.length,start:e.start,...this.searchData}}async ajaxSend(e,t){this.resetForm();const a=this.getDefaultSearchInputField();a.val()&&a.val().trim()&&a.prop("readOnly",!0),await axios(this.pathOptions.searchPath,{params:this.generateRequestData(e)}).then((e=>{t(e.data),this.options.beforeSendRequest&&this.options.beforeSendRequest(e.data)})).catch((e=>{console.log("err",e),this.errorHandler(e),t({data:[],recordsFiltered:0})})).finally((()=>{a.prop("readOnly",!1)})),this.searchFromLoading()}errorHandler(e){if(e=e.response.data){const t=this.searchFormEl;t.find(".validation-error").removeClass("has-error"),t.find(".form-group").removeClass("is-invalid");for(const[a,s]of Object.entries(e.errors)){const e=a.substring(2);let r=t.find(`.validation-error[data-name="${e}"]`);r.length||(r=t.find(`.validation-error[data-name="${e}[]"]`)),r.closest(".form-group").addClass("is-invalid"),r.html(s).addClass("has-error")}}}resetForm(){this.searchFormEl.find(".validation-error").html(""),this.searchFormEl.find(".form-group").removeClass("is-invalid")}generateOptions(){const e=this.getCurrentModuleName(),t={processing:!0,serverSide:!0,searching:!0,ajax:this.ajaxSend.bind(this),order:[[0,"desc"]],pageLength:25,columns:this.getAndGenerateColumns(),bStateSave:!0,stateSaveCallback(t,s){const r={};s.search&&(s.search.search=""),r[e]=s,localStorage.setItem(a,JSON.stringify(r))},language:{search:"",searchPlaceholder:$trans("__dashboard.datatable.search_input_placeholder")}},s=JSON.parse(localStorage.getItem(a));s&&s[e]&&(t.stateLoadCallback=()=>s[e]),this.options={...t,...this.options}}tableReload(){this.table.ajax.reload()}eventListener(){window.addEventListener("deleteDataTableRow",(()=>{this.tableReload()}))}searchFromLoading(e){const t=this.searchFormEl.find("button.search__form__btn"),a=this.searchFormEl.find("button.reset__form__btn"),s=this.searchFormEl.find(".loading__form__icon");e?(s.addClass("d-inline-block "),t.prop("disabled",!0),a.prop("disabled",!0)):(s.removeClass("d-inline-block"),t.prop("disabled",!1),a.prop("disabled",!1))}searchFormReset(){this.searchFormEl.find(".reset__form__btn").click((()=>{this.searchFromLoading(!0),this.searchData={},this.searchFormEl[0].reset(),this.table.search(""),this.clearSearchedDataFromLocalstorage(),this.searchFormEl.find(".select2").val(null).trigger("change"),this.tableReload(),this.getSearchCollapse().removeClass("has-default-values")}))}searchFormSubmit(e){e.preventDefault();const t=e.target;this.searchData={},this.searchFromLoading(!0),$(t).serializeArray().map(((e,a)=>{let s="";$(t).find(`select[name="${e.name}"][multiple]`).length&&(s=`[${a}]`),this.searchData[`f[${e.name}]${s}`]=e.value})),this.table.search().length&&(this.searchData["f[search]"]=this.table.search()),this.storeSearchedData(),this.tableReload()}storeSearchedData(){if(this.storeSearchData()){const e=this.searchFormEl.serializeArray().filter((e=>""!==e.value||"show_status"===e.name)),a={};a[this.getCurrentModuleName()]=e,localStorage.setItem(t,JSON.stringify(a)),this.options.afterStoreSearchedData&&this.options.afterStoreSearchedData(a)}}setSearchStoredData(){if(this.storeSearchData()){const e=JSON.parse(localStorage.getItem(t)),a=this.getCurrentModuleName();if(e&&e[a]&&e[a].length){const t=this,s=e[a];let r=!0;1===s.length&&-1!==$.inArray(s[0].name,["search","show_status"])&&(r=!1),2===s.length&&"show_status"===s[0].name&&"search"===s[1].name&&(r=!1),r&&this.showSearchCollapse();const i=s.reduce(((e,t)=>(void 0===e[t.name]?e[t.name]=t.value:Array.isArray(e[t.name])?e[t.name].push(t.value):e[t.name]=[e[t.name],t.value],e)),{});$.each(i,((e,a)=>{const s=t.searchFormEl.find(`:input[name='${e}']`);!Array.isArray(a)&&s.attr("multiple")})),this.options.afterSetSearchStoredData&&this.options.afterSetSearchStoredData(s)}}}getSearchCollapse(){return this.searchFormEl.closest(".datatable-search-collapse").find(".collapse")}showSearchCollapse(){this.getSearchCollapse().addClass("has-default-values show")}getCurrentModuleName(){return location.pathname.split("/")[3]}clearSearchedDataFromLocalstorage(){localStorage.removeItem(t),localStorage.removeItem(a)}defaultSearchData(){const e=this;$.each(this.searchFormEl.find(".default-search"),((t,a)=>{e.searchData[`f[${$(a).attr("name")}]`]=$(a).val()}))}createDataTable(){this.table=this.tableEl.DataTable(this.options)}defaultSearchInput(){const e=this;let t;this.getDefaultSearchInputField().unbind().bind("keyup input",(function(){clearTimeout(t),t=setTimeout((()=>{e.searchData["f[search]"]=$(this).val(),e.table.search($(this).val()),e.tableReload(),e.storeSearchedData()}),330)}))}getDefaultSearchInputField(){return $(`#${this.tableId.substring(1)}_filter`).find("input")}$_functions(){this.createDataTable(),this.searchFormEl.submit(this.searchFormSubmit.bind(this))}init(){this.actions(),this.defaultSearchData(),this.generateOptions(),this.eventListener(),this.$_functions(),this.searchFormReset(),this.defaultSearchInput()}})}}}));
//# sourceMappingURL=DataTable-legacy-CtzCtnpX.js.map
